# Path models (SEM 1) {#ch-SEM-path-models}

<!-- https://stats.oarc.ucla.edu/r/seminars/rsem/ -->

Up to now, we have considered models with a single dependent variable, allowing the value of this to depend on multiple predictors or independent variables. Whilst flexible, this can be restrictive. There are many situations where we would like to model how a set of variables relate to eachother. We saw an example of this when we considered *mediation*, where we were interested in how an independent variable affects a mediator variable, and how this mediator variable subsequently affects the dependent variable. Applying the causal steps approach, we needed to estimate a number of separate models, with inference being based on a comparison of estimated parameters between three models.

In the next few chapters, we will consider ways in which to account for relations between many variables within a single model. The general term for such a model is a **Structural Equation Model** (SEM). As we will see, this term encapsulates a wide variety of models, including many of those we have discussed before. These models even allow us to incorporate **latent variables**, which are variables that are not directly observed, but whose values can be inferred (or measured) from their relations with observed variables. We will consider such latent variable models in the next chapter. Here, we will focus on models which contain only observed variables. 

## Graphical models

A graphical model -- or more precisely a **probabilistic graphical model** -- in statistics refers to an abstract way to represent dependencies and independences in a set of random variables. ... In mathematics, a graph consists of a set of nodes, and edges between them. For example, in social network graphs, the nodes represent people, and edges represent whether they are friends, or communicate with each other. So **nodes** are the objects, and **edges** are the relations between these objects we focus on. For our purposes, the nodes represent variables and the edges the statistical relations between these.

Probabilistic graphical models take many guises. For one thing, edges can be directed, or undirected. A directed edge means that the relation goes one way. For instance, the value of one variable can cause the value of another. An undirected relation means that two variables covary, but a causal relation is not assumed. This can be also represented by a dual-directed edge (indicating that both variables influence each other).

A nice aspect of graphical models is that they visualise often complex multiple relations in a large set of variables. This can aid our understanding of a model. Graphs are, in a sense, a visual language to express models. The model itself doesn't need the graph, but our understanding of them often does.

In **Directed graphs** with directed edges (arrows), nodes (variables) can have parents (edges coming in from other nodes) and children (edges going out to other nodes). Relations between parents and children can be viewed as lines of communication. Parents can send messages to their children, but in a directed graph, not the other way round.

### Conventions in graphical representations of structural equation models

Graphical representations of structural equation models are often slightly more detailed than general probabilistic graphical models. In particular, different symbols are used to distinguish between observed variables, latent (unobserved) variables, constants (e.g. intercepts). 

## Exogenous and endogenous variables

**Exogeneous variables** are variables that are not "accounted for" by other variables in the model. In terms of a graphical model, these variables have no parents (i.e. incoming arrows from other variables). **Endogeneous variables** are accounted for by other variables in the model; they do have parents (e.g. incoming arrows from other variables in the model).

## Multiple regression model

Multiple regression is perhaps the simplest example of a path model. It has multiple exonegenous variables $X_j$, and a single endogenous variable $Y$.

```{r}
library(sdamr)
library(lavaan)
data("trump2016")
dat <- subset(trump2016,state != "District of Columbia")

regmod <-   '
  # regressions
    percent_Trump_votes ~ 1 + hate_groups_per_million + percent_bachelors_degree_or_higher
'
fregmod <- lavaan::sem(regmod, data=trump2016)
summary(fmod1)
```

## A mediation model

```{r}

data("legacy2015")

mod1 <-   '
  # regressions
    intention ~ 1 + legacy
    donation ~ 1 + intention
'
fmod1 <- lavaan::sem(mod1, data=legacy2015)
summary(fmod1)

mod2 <-   '
  # regressions
    intention ~ 1 + legacy
    donation ~ 1 + intention + legacy
'
fmod2 <- lavaan::sem(mod2, data=legacy2015)
summary(fmod2)

```

## Looking ahead

### Multivariate Normal distribution

### A little bit of matrix algebra

<!-- https://bookdown.org/compfinezbook/introFinRbook/Matrix-Algebra-Review.html -->
<!-- https://bkenkel.com/pdaps/matrix.html -->

## Errors-in-variable models
